<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Singletonè¯¥æ–‡è®²è¿°äº†ä¸‰ç§æ–¹æ³•æ¥åˆ›å»ºå•ä¾‹, å„ç§æ–¹æ³•çš„ä¼˜ç‚¹ä»¥åŠç¼ºç‚¹ï¼Œè¯¥æ–‡ä¹Ÿä»‹ç»äº†å¦å¤–ä¸€ç¯‡æ–‡ç« å•ä¾‹çš„Are Singletons Badã€‚ åŸæ–‡åœ°å€">
<meta property="og:type" content="article">
<meta property="og:title" content="Singleton">
<meta property="og:url" content="http://example.com/2018/12/21/Swift/Singleton/index.html">
<meta property="og:site_name" content="HR&#39;s Blog">
<meta property="og:description" content="Singletonè¯¥æ–‡è®²è¿°äº†ä¸‰ç§æ–¹æ³•æ¥åˆ›å»ºå•ä¾‹, å„ç§æ–¹æ³•çš„ä¼˜ç‚¹ä»¥åŠç¼ºç‚¹ï¼Œè¯¥æ–‡ä¹Ÿä»‹ç»äº†å¦å¤–ä¸€ç¯‡æ–‡ç« å•ä¾‹çš„Are Singletons Badã€‚ åŸæ–‡åœ°å€">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-12-21T07:12:43.000Z">
<meta property="article:modified_time" content="2018-12-21T07:12:43.000Z">
<meta property="article:author" content="HR">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2018/12/21/Swift/Singleton/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Singleton | HR's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-61905451-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-61905451-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1b08dac8932c829229886a7ff2235549";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HR's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Swimming ğŸŠ in the seağŸŒŠof code!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/12/21/Swift/Singleton/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HR">
      <meta itemprop="description" content="Swimming ğŸŠ in the seağŸŒŠof code!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HR's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Singleton
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-21 15:12:43" itemprop="dateCreated datePublished" datetime="2018-12-21T15:12:43+08:00">2018-12-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index"><span itemprop="name">Swift</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h1><p>è¯¥æ–‡è®²è¿°äº†ä¸‰ç§æ–¹æ³•æ¥åˆ›å»ºå•ä¾‹, å„ç§æ–¹æ³•çš„ä¼˜ç‚¹ä»¥åŠç¼ºç‚¹ï¼Œè¯¥æ–‡ä¹Ÿä»‹ç»äº†å¦å¤–ä¸€ç¯‡æ–‡ç« å•ä¾‹çš„Are Singletons Badã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cocoacasts.com/what-is-a-singleton-and-how-to-create-one-in-swift">åŸæ–‡åœ°å€</a></p>
<span id="more"></span>

<h1 id="What-Is-a-Singleton-and-How-To-Create-One-In-Swift"><a href="#What-Is-a-Singleton-and-How-To-Create-One-In-Swift" class="headerlink" title="What Is a Singleton and How To Create One In Swift"></a>What Is a Singleton and How To Create One In Swift</h1><p>The singleton pattern is a widely used design pattern in software development. Despite its popularity, itâ€™s often considered an anti-pattern. Why is that? In this episode, I explain what the singleton pattern entails and how to create singletons in Swift.</p>
<h2 id="What-Is-a-Singleton"><a href="#What-Is-a-Singleton" class="headerlink" title="What Is a Singleton"></a>What Is a Singleton</h2><p>Singletons are easy to understand. The singleton pattern guarantees that only one instance of a class is instantiated. Thatâ€™s simple. Right?</p>
<blockquote>
<p>The singleton pattern guarantees that only one instance of a class is instantiated.<br>å•ä¾‹æ¨¡å¼ä¿è¯åªå®ä¾‹åŒ–ä¸€ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
</blockquote>
<p>If youâ€™ve worked with Appleâ€™s frameworks, then chances are that youâ€™ve already used the singleton pattern. Take a look at these examples. They probably look familiar.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Shared URL Session</span></span><br><span class="line"><span class="keyword">let</span> sharedURLSession <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default File Manager</span></span><br><span class="line"><span class="keyword">let</span> defaultFileManager <span class="operator">=</span> <span class="type">FileManager</span>.default</span><br><span class="line"></span><br><span class="line"><span class="comment">// Standard User Defaults</span></span><br><span class="line"><span class="keyword">let</span> standardUserDefaults <span class="operator">=</span> <span class="type">UserDefaults</span>.standard</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default Payment Queue</span></span><br><span class="line"><span class="keyword">let</span> defaultPaymentQueue <span class="operator">=</span> <span class="type">SKPaymentQueue</span>.default()</span><br></pre></td></tr></table></figure>

<p>The singleton pattern is a very useful pattern. There are times that you want to make sure only one instance of a class is instantiated and that your application only uses that instance. Thatâ€™s the primary and only goal of the singleton pattern.</p>
<p>The default payment queue of theÂ <strong>StoreKit</strong>Â framework is a fine example. An application should never create an instance of theÂ <code>SKPaymentQueue</code>Â class. The operating system uses theÂ <strong>StoreKit</strong>Â framework to create a payment queue, which your application can use. The default payment queue is accessible through theÂ <code>default()</code>Â class method of theÂ <code>SKPaymentQueue</code>Â class. This is a good example of how the singleton pattern should be applied.</p>
<h2 id="Global-Access"><a href="#Global-Access" class="headerlink" title="Global Access"></a>Global Access</h2><p>But the singleton pattern has a side effect thatâ€™s often the true reason for adopting the singleton pattern,Â <strong>global access</strong>. But having global access to the singleton object is no more than a side effect of the singleton pattern.</p>
<p>Unfortunately, many developers use the singleton pattern to have easy access to the singleton object from anywhere in their project. The default payment queue is accessible through theÂ <code>default()</code>Â class method. This means that any object in a project can access the default payment queue. While this is convenient, that convenience comes at a price.</p>
<p>If you want to learn more about the problems surrounding the singleton pattern, then I recommend readingÂ <a target="_blank" rel="noopener" href="https://cocoacasts.com/are-singletons-bad/">Are Singletons Bad</a>. In that article, I discuss this topic in more detail.</p>
<h2 id="How-to-Create-a-Singleton-In-Swift"><a href="#How-to-Create-a-Singleton-In-Swift" class="headerlink" title="How to Create a Singleton In Swift"></a>How to Create a Singleton In Swift</h2><p>In this episode, I list two recipes for implementing the singleton pattern in Swift. The first implementation shouldnâ€™t be used, though. It merely illustrates a few concepts of the Swift language. ä¸¤ç§å®ç°çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸åº”è¯¥ç”¨ç¬¬ä¸€ä¸ªæ¥å®ç°ï¼Œä»…ä»…æ˜¯ç”¨ä»–æ¥è¯´æ˜swiftè¯­è¨€çš„ä¸€äº›æ¦‚å¿µã€‚</p>
<h3 id="Global-Variables"><a href="#Global-Variables" class="headerlink" title="Global Variables"></a>Global Variables</h3><p>The most straightforward technique to create a singleton is by defining a global variable.æœ€ç®€å•æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sharedNetworkManager <span class="operator">=</span> <span class="type">NetworkManager</span>(baseURL: <span class="type">API</span>.baseURL)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkManager</span> </span>&#123;</span><br><span class="line">        <span class="comment">// MARK: - Properties</span></span><br><span class="line">        <span class="keyword">let</span> baseURL: <span class="type">URL</span></span><br><span class="line">        <span class="comment">// Initialization</span></span><br><span class="line">        <span class="function"><span class="keyword">init</span>(<span class="params">baseURL</span>: <span class="type">URL</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.baseURL <span class="operator">=</span> baseURL</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰åœ¨å…¨å±€çš„å˜é‡ï¼Œä»»ä½•åœ¨moduleé‡Œçš„å¯¹è±¡éƒ½å¯ä»¥è®¿é—®è¯¥å˜é‡ã€‚<br>By defining a variable in the global namespace of the project, any object in the module has access to the singleton object. We could, for example, access the singleton object in theÂ <code>application(_:didFinishLaunchingWithOptions:)</code>Â method of theÂ <code>AppDelegate</code>Â class.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="params">UIApplicationLaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(sharedNetworkManager)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In Swift, global variables are initialized lazily. This means that the initializer is run the first time the global variable is referenced. <code>Swift</code>ä¸­å…¨å±€å˜é‡åªæœ‰è¢«å¼•ç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆ›å»ºã€‚</p>
<p>An added benefit of Swiftâ€™s approach is that the initialization is performed using theÂ <code>dispatch_once</code>Â function. It guarantees that the initializer is invoked only once. Thatâ€™s important since you only want to initialize the singleton object once.</p>
<p>Using a global variable has several shortcomings. The most important problem is cluttering the global namespace. Another downside is that the initializer of theÂ <code>NetworkManager</code>Â class cannot be declared private. This means that multiple instances of the classÂ <em>can</em>Â be instantiated. Let me show you a much better, and my preferred, implementation in Swift.<br>ä½¿ç”¨å…¨å±€å˜é‡æ¥ç”³æ˜å•ä¾‹æœ‰ä»¥ä¸‹çš„ç¼ºç‚¹ï¼Œç¬¬ä¸€å°±æ˜¯æ±¡æŸ“äº†å…¨å±€çš„å‘½åç©ºé—´ã€‚å…¶äºŒå°±æ˜¯å•ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•æ²¡æœ‰åŠæ³•å£°æ˜ä¸º<code>private</code>ï¼Œè¿™ä¹Ÿå°±æ²¡æœ‰åŠæ³•ä¿è¯å•ä¾‹çš„å”¯ä¸€æ€§ã€‚</p>
<h3 id="Static-Property-and-Private-Initializer"><a href="#Static-Property-and-Private-Initializer" class="headerlink" title="Static Property and Private Initializer"></a>Static Property and Private Initializer</h3><p>A few years ago, Swift introduced static properties and access control to the language. This opened up an alternative approach to implementing the singleton pattern in Swift. Itâ€™s much cleaner and elegant than using a global variable. Take a look at the updated example.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkManager</span> </span>&#123;</span><br><span class="line">        <span class="comment">// MARK: - Properties</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">NetworkManager</span>(baseURL: <span class="type">API</span>.baseURL)</span><br><span class="line">        <span class="comment">// MARK: -</span></span><br><span class="line">        <span class="keyword">let</span> baseURL: <span class="type">URL</span></span><br><span class="line">        <span class="comment">// Initialization</span></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>(<span class="params">baseURL</span>: <span class="type">URL</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.baseURL <span class="operator">=</span> baseURL</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Accessing the singleton is intuitive and it clearly conveys that weâ€™re dealing with a singleton.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="params">UIApplicationLaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">NetworkManager</span>.shared)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªå‡ ä¸ªå®ç°ç»†èŠ‚çš„å˜åŒ–ï¼Œç¬¬ä¸€å°±æ˜¯åˆå§‹åŒ–æ–¹æ³•æ˜¯ç§æœ‰çš„ã€‚ä¹Ÿå°±æ„å‘³ç€åªæœ‰<code>NetworkManager</code>ç±»èƒ½åˆ›å»ºè‡ªå·±çš„å®ä¾‹ã€‚è¿™æ˜¯è‡³å…³é‡è¦çš„ç¬¬ä¸€ç‚¹<br>Several implementation details have changed. First, the initializer is private. It means that only theÂ <code>NetworkManager</code>Â class can create instances of itself. Thatâ€™s a significant advantage.</p>
<p>ç¬¬äºŒæˆ‘ä»¬ç”³æ˜äº†<code>shared</code>çš„<code>static constant property</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§å…è®¸å…¶ä»–çš„å¯¹è±¡è®¿é—®åˆ°è¿™ä¸ªå•ä¾‹ã€‚<br>Second, we declared theÂ <code>shared</code>Â static constant property. This property gives other objects access to the singleton object of theÂ <code>NetworkManager</code>Â class.</p>
<p>è¿™é‡Œä¸éœ€è¦ç»™<code>static properties</code>çš„å±æ€§åŠ ä¸Š<code>lazy</code>å…³é”®å­—ï¼Œä¹‹å‰æåˆ°è¿‡å…¨å±€å˜é‡é»˜è®¤çš„å°±æ˜¯lazyçš„ã€‚<br>It isnâ€™t necessary to mark static properties with theÂ <code>lazy</code>Â keyword. Remember what I said earlier, the initializer of global variables and static properties are executed lazily by default. Thatâ€™s another benefit.</p>
<p>I want to share one more implementation of the singleton pattern. This implementation is a bit more complex. The main difference is that the singleton object is instantiated in a closure, allowing for a more complex initialization and configuration of the singleton object.è¿™é‡Œæˆ‘å°†åˆ†äº«å¦å¤–ä¸€ç§å•ä¾‹çš„å®ç°ï¼Œè¿™ç§å®ç°ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œä¸»è¦çš„ä¸åŒå°±æ˜¯ï¼Œå¯¹è±¡çš„åˆå§‹åŒ–æ˜¯åœ¨ä¸€ä¸ª<code>closure</code>ä¸­å®Œæˆçš„ï¼Œè¿™ä¹Ÿå°±å…è®¸æ›´å¤æ‚çš„åˆå§‹åŒ–å’Œå•ä¾‹è‡ªèº«çš„é…ç½®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// MARK: - Properties</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">var</span> sharedNetworkManager: <span class="type">NetworkManager</span> <span class="operator">=</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> networkManager <span class="operator">=</span> <span class="type">NetworkManager</span>(baseURL: <span class="type">API</span>.baseURL)</span><br><span class="line">        <span class="comment">// Configuration</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> networkManager</span><br><span class="line">        &#125;()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// MARK: -</span></span><br><span class="line">        <span class="keyword">let</span> baseURL: <span class="type">URL</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Initialization</span></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">init</span>(<span class="params">baseURL</span>: <span class="type">URL</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.baseURL <span class="operator">=</span> baseURL</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// MARK: - Accessors</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">shared</span>() -&gt; <span class="title">NetworkManager</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sharedNetworkManager</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The static property is declared private. The singleton object is accessible through theÂ <code>shared()</code>Â class method.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="params">UIApplicationLaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>)</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="type">NetworkManager</span>.shared())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cocoa-and-Singletons"><a href="#Cocoa-and-Singletons" class="headerlink" title="Cocoa and Singletons"></a>Cocoa and Singletons</h2><p>With these implementations in mind, we have mimicked the interface many Cocoa frameworks have adopted in Swift.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Shared URL Session</span></span><br><span class="line"><span class="keyword">let</span> sharedURLSession <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default File Manager</span></span><br><span class="line"><span class="keyword">let</span> defaultFileManager <span class="operator">=</span> <span class="type">FileManager</span>.default</span><br><span class="line"></span><br><span class="line"><span class="comment">// Standard User Defaults</span></span><br><span class="line"><span class="keyword">let</span> standardUserDefaults <span class="operator">=</span> <span class="type">UserDefaults</span>.standard</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default Payment Queue</span></span><br><span class="line"><span class="keyword">let</span> defaultPaymentQueue <span class="operator">=</span> <span class="type">SKPaymentQueue</span>.default()</span><br></pre></td></tr></table></figure>

<h2 id="Are-Singletons-Bad"><a href="#Are-Singletons-Bad" class="headerlink" title="Are Singletons Bad"></a>Are Singletons Bad</h2><p>InÂ <a target="_blank" rel="noopener" href="https://cocoacasts.com/are-singletons-bad/">Are Singletons Bad</a>, I explain in detail what type of problems the singleton pattern can introduce in a project. My advice is to use singletons sparingly. Very sparingly. If youâ€™re about to create a singleton, take a moment and step back. Is there another option you may be overlooking? Is it absolutely necessary to use the singleton pattern?</p>
<p>Even though thereâ€™s nothing inherently wrong with singletons, most developers use it for the wrong reasons, that is, convenience. They disguise global variables as singletons.</p>
<h2 id="Dependency-Injection"><a href="#Dependency-Injection" class="headerlink" title="Dependency Injection"></a>Dependency Injection</h2><p>Even if you decide to use singletons in a project, that doesnâ€™t mean youÂ <em>have to</em>Â access them from anywhere in your project. You can still use dependency injection to pass the singleton object to the objects that need it.</p>
<p>By adopting dependency injection to pass singletons around, the interface of your class remains clear and transparent. In other words, the interface of the class describes its dependencies. This is very, very useful. It immediately shows which objects the class needs to perform its duties.</p>
<p>One of the things I miss about Objective-C is the header file. The header file summarizes the public interface of a class, including the dependencies of the class. This is sometimes less obvious in Swift.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/12/21/Swift/String/" rel="prev" title="String">
      <i class="fa fa-chevron-left"></i> String
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/12/21/Swift/Pattern%20matching/" rel="next" title="Pattern matching">
      Pattern matching <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Singleton"><span class="nav-number">1.</span> <span class="nav-text">Singleton</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-Is-a-Singleton-and-How-To-Create-One-In-Swift"><span class="nav-number">2.</span> <span class="nav-text">What Is a Singleton and How To Create One In Swift</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-Is-a-Singleton"><span class="nav-number">2.1.</span> <span class="nav-text">What Is a Singleton</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Global-Access"><span class="nav-number">2.2.</span> <span class="nav-text">Global Access</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-Create-a-Singleton-In-Swift"><span class="nav-number">2.3.</span> <span class="nav-text">How to Create a Singleton In Swift</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Global-Variables"><span class="nav-number">2.3.1.</span> <span class="nav-text">Global Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Static-Property-and-Private-Initializer"><span class="nav-number">2.3.2.</span> <span class="nav-text">Static Property and Private Initializer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cocoa-and-Singletons"><span class="nav-number">2.4.</span> <span class="nav-text">Cocoa and Singletons</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Are-Singletons-Bad"><span class="nav-number">2.5.</span> <span class="nav-text">Are Singletons Bad</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dependency-Injection"><span class="nav-number">2.6.</span> <span class="nav-text">Dependency Injection</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">HR</p>
  <div class="site-description" itemprop="description">Swimming ğŸŠ in the seağŸŒŠof code!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:caohr@outlook.com" title="E-Mail â†’ mailto:caohr@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HR</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
